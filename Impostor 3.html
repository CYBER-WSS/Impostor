<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Packet Analysis</title>
<style>
* {box-sizing: border-box;margin:0;padding:0;}
body {font-family: monospace;color: chartreuse;background-color: black;padding: 20px;line-height:1.6;overflow-x: hidden;position: relative;}
.container {max-width: 1200px;margin:0 auto;background-color:black;border-radius:8px;overflow:hidden;position: relative;z-index: 2;}

/* Binary Rain */
.binary-rain {position: fixed;top: 0;left: 0;width: 100%;height: 100%;pointer-events: none;z-index: 1;opacity: 0.3;}
.binary-digit {position: absolute;color: chartreuse;font-size: 14px;font-family: monospace;animation: fall linear infinite;}

@keyframes fall {
    to { transform: translateY(100vh); }
}

header {background: linear-gradient(to right,darkgreen, chartreuse);color:white;padding:24px 30px;border-bottom:1px solid black;}
h1 {font-size:26px;margin-bottom:8px;display:flex;align-items:center;}
h1 i {margin-right:12px;font-size:28px;}
.subtitle {font-size:15px;opacity:0.85;margin-bottom:12px;}
.training-controls {padding:20px 30px;background-color:black;border-bottom:1px solid #e1e8ed;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;}
.timer-container {display:flex;align-items:center;gap:10px;font-weight:600;font-size:18px;}
.timer {background-color:green;color:white;padding:8px 16px;border-radius:20px;min-width:100px;text-align:center;}
.attempts {background-color:red;color:white;padding:8px 16px;border-radius:20px;min-width:120px;text-align:center;}
.progress-container {flex-grow:1;max-width:300px;}
.progress-bar {height:20px;background-color:lightgreen;border-radius:10px;overflow:hidden;}
.progress {height:100%;background: linear-gradient(90deg, #28a745, #20c997);width:0%;transition: width 0.5s ease;border-radius:10px;}
.progress-text {text-align:center;font-size:14px;margin-top:5px;font-weight:600;}
.task-instructions {background-color:black;padding:15px 30px;border-bottom:1px solid black;}
.instructions {font-size:16px;color:green;}
.instructions strong {color:red;}

.packet-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px;
    height: 400px;
}

.packet-column {
    background: rgba(0,20,0,0.8);
    border: 2px solid var(--matrix-green);
    border-radius: 8px;
    padding: 15px;
}

.packet-column h3 {
    text-align: center;
    margin-bottom: 15px;
    color: chartreuse;
}

.packet-list {
    height: 320px;
    overflow-y: auto;
    padding: 10px;
    background: rgba(0,0,0,0.3);
    border-radius: 5px;
}

.packet-item {
    background: rgba(0,255,65,0.05);
    border: 1px solid rgba(0,255,65,0.3);
    border-radius: 5px;
    padding: 12px;
    margin-bottom: 8px;
    cursor: grab;
    transition: all 0.3s ease;
    font-size: 12px;
    font-family: monospace;
    position: relative;
}

.packet-item:hover {
    background: rgba(0,255,65,0.1);
}

.packet-item.dragging {
    opacity: 0.5;
}

.packet-info {
    display: grid;
    grid-template-columns: 80px 100px 80px 100px auto;
    gap: 8px;
    font-size: 11px;
}

.protocol-tcp { border-left: 3px solid #00ff88; }
.protocol-udp { border-left: 3px solid #ffaa00; }
.protocol-icmp { border-left: 3px solid #ff4444; }
.protocol-http { border-left: 3px solid #4488ff; }

/* Make suspicious packets more obvious */
.suspicious-packet {
    background: rgba(255,50,50,0.1) !important;
    border: 1px solid rgba(255,100,100,0.5) !important;
    animation: pulse-warning 2s infinite;
}

.suspicious-indicator {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 8px;
    height: 8px;
    background: red;
    border-radius: 50%;
    animation: blink 1s infinite;
}

@keyframes pulse-warning {
    0% { box-shadow: 0 0 0 0 rgba(255,0,0,0.4); }
    70% { box-shadow: 0 0 0 5px rgba(255,0,0,0); }
    100% { box-shadow: 0 0 0 0 rgba(255,0,0,0); }
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

/* Hint box */
.hint-box {
    background: rgba(0,50,0,0.3);
    border: 1px solid rgba(0,255,100,0.5);
    border-radius: 8px;
    padding: 12px;
    margin: 10px 20px;
    font-size: 14px;
}

.hint-box h4 {
    color: #88ff88;
    margin-bottom: 8px;
}

.hint-box ul {
    margin-left: 20px;
}

.hint-box li {
    margin-bottom: 5px;
}

.actions {padding:20px 30px;background:chartreuse;border-top:1px solid #e1e8ed;display:flex;justify-content:center;gap:15px;}
button {padding:12px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s ease;font-size:16px;}
#submitBtn {background-color:green;color:white;}
#submitBtn:disabled {background-color:green;cursor:not-allowed;color:black;}
#resetBtn {background-color:black;color:green;}
.footer {padding:18px 30px;background: linear-gradient(to right,darkgreen, chartreuse);border-top:1px solid green;text-align:center;color:black;font-size:14px;}
.results {padding:20px 30px;text-align:center;display:none;}
.results h2 {margin-bottom:15px;color:#155724;}
.score {font-size:24px;font-weight:bold;margin:20px 0;color:#0f5132;}

/* Success animation */
.success-pulse {
    animation: success-pulse 0.5s ease-in-out;
}

@keyframes success-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

</style>
</head>
<body>
<!-- Binary Rain Background -->
<div class="binary-rain" id="binaryRain"></div>

<div class="container">
<header>
<h1><i>üì°</i> Network Packet Analysis</h1>
<div class="subtitle">Analyze network traffic and identify suspicious packets</div>
</header>

<div class="training-controls">
<div class="timer-container">
<span>Time Remaining:</span>
<div class="timer" id="timer">03:00</div>
</div>
<div class="timer-container">
<span>Attempts Left:</span>
<div class="attempts" id="attempts">5</div>
</div>
<div class="progress-container">
<div class="progress-bar">
<div class="progress" id="progress"></div>
</div>
<div class="progress-text" id="progressText">Progress: 0%</div>
</div>
</div>

<div class="task-instructions">
<div class="instructions">
<strong>Training Task:</strong> Drag suspicious network packets to the "Suspicious" column. Look for unusual ports, protocols, or data patterns. You have <strong>5 attempts</strong> and <strong>3 minutes</strong>.
</div>
</div>

<div class="hint-box">
<h4>üí° HINT: Look for these suspicious indicators:</h4>
<ul>
    <li>Unusual ports like 4444, 31337, 8080</li>
    <li>Large packet sizes (> 2KB)</li>
    <li>Unknown external IP addresses</li>
    <li>Unusual protocols or flags</li>
    <li>Packets with red blinking dots are suspicious!</li>
</ul>
</div>

<div class="packet-container">
<div class="packet-column" id="incomingColumn">
<h3>üì• Incoming Packets</h3>
<div class="packet-list" id="incomingList"></div>
</div>
<div class="packet-column" id="suspiciousColumn">
<h3>üö´ Suspicious Packets</h3>
<div class="packet-list" id="suspiciousList"></div>
</div>
</div>

<div class="actions">
<button id="submitBtn" disabled>Analyze Packets</button>
<button id="resetBtn">Reset Selection</button>
</div>

<div class="results" id="results">
<h2 id="resultTitle">Analysis Complete</h2>
<div class="score" id="scoreDisplay">Accuracy: 0%</div>
<div id="resultDetails"></div>
</div>

<div class="footer">Network Packet Analysis - 5 Attempts Maximum</div>
</div>

<script>
// Create Binary Rain
function createBinaryRain() {
    const container = document.getElementById('binaryRain');
    const binaryChars = '01';
    const count = 25;
    
    for (let i = 0; i < count; i++) {
        const digit = document.createElement('div');
        digit.className = 'binary-digit';
        digit.textContent = binaryChars[Math.floor(Math.random() * binaryChars.length)];
        digit.style.left = Math.random() * 100 + 'vw';
        digit.style.animationDuration = (3 + Math.random() * 5) + 's';
        digit.style.animationDelay = Math.random() * 2 + 's';
        digit.style.opacity = Math.random() * 0.4 + 0.1;
        container.appendChild(digit);
    }
}

// Network packet data - Made easier with clearer indicators
const packets = [
    // Normal packets (safe)
    { id: 1, source: "192.168.1.10", dest: "8.8.8.8", protocol: "DNS", port: "53", size: "512B", flags: "QUERY", suspicious: false },
    { id: 2, source: "192.168.1.15", dest: "172.217.14.110", protocol: "HTTPS", port: "443", size: "1.2KB", flags: "ACK", suspicious: false },
    { id: 3, source: "192.168.1.20", dest: "192.168.1.1", protocol: "ICMP", port: "N/A", size: "84B", flags: "ECHO", suspicious: false },
    { id: 4, source: "192.168.1.25", dest: "93.184.216.34", protocol: "HTTP", port: "80", size: "2.1KB", flags: "GET", suspicious: false },
    { id: 5, source: "192.168.1.30", dest: "192.168.1.100", protocol: "SSH", port: "22", size: "768B", flags: "AUTH", suspicious: false },
    
    // Suspicious packets (dangerous - with clear indicators)
    { id: 6, source: "45.83.212.99", dest: "192.168.1.10", protocol: "TCP", port: "4444", size: "4.2KB", flags: "SYN", suspicious: true },
    { id: 7, source: "192.168.1.10", dest: "198.51.100.44", protocol: "TCP", port: "8080", size: "8.7KB", flags: "PSH", suspicious: true },
    { id: 8, source: "203.0.113.21", dest: "192.168.1.15", protocol: "UDP", port: "31337", size: "1.8KB", flags: "DATA", suspicious: true },
    { id: 9, source: "10.0.0.250", dest: "192.168.1.20", protocol: "ICMP", port: "N/A", size: "2.4KB", flags: "TIMESTAMP", suspicious: true },
    { id: 10, source: "192.168.1.99", dest: "192.168.1.255", protocol: "UDP", port: "1900", size: "3.1KB", flags: "BROADCAST", suspicious: true }
];

const incomingList = document.getElementById('incomingList');
const suspiciousList = document.getElementById('suspiciousList');
const timerElement = document.getElementById('timer');
const attemptsElement = document.getElementById('attempts');
const progressElement = document.getElementById('progress');
const progressText = document.getElementById('progressText');
const submitBtn = document.getElementById('submitBtn');
const resetBtn = document.getElementById('resetBtn');
const resultsElement = document.getElementById('results');
const scoreDisplay = document.getElementById('scoreDisplay');
const resultDetails = document.getElementById('resultDetails');
const resultTitle = document.getElementById('resultTitle');

let selectedPackets = [];
let timeLeft = 3 * 60; // 3 minutes
let timerInterval;
let attemptsLeft = 5; // Increased attempts
let gameCompleted = false;
let progress = 0;
let draggedPacket = null;

// Initialize packets
function initializePackets() {
    incomingList.innerHTML = '';
    suspiciousList.innerHTML = '';
    selectedPackets = [];
    
    // Shuffle packets
    const shuffledPackets = [...packets].sort(() => Math.random() - 0.5);
    
    shuffledPackets.forEach(packet => {
        const packetElement = document.createElement('div');
        packetElement.className = `packet-item protocol-${packet.protocol.toLowerCase()} ${packet.suspicious ? 'suspicious-packet' : ''}`;
        packetElement.draggable = true;
        packetElement.dataset.id = packet.id;
        packetElement.dataset.suspicious = packet.suspicious;
        
        // Add visual indicator for suspicious packets
        if (packet.suspicious) {
            const indicator = document.createElement('div');
            indicator.className = 'suspicious-indicator';
            packetElement.appendChild(indicator);
        }
        
        packetElement.innerHTML += `
            <div class="packet-info">
                <span>${packet.source}</span>
                <span>‚Üí ${packet.dest}</span>
                <span>${packet.protocol}</span>
                <span>Port: ${packet.port}</span>
                <span>${packet.size}</span>
            </div>
            <div style="font-size:10px; color:#88ff88; margin-top:4px;">Flags: ${packet.flags}</div>
        `;
        
        packetElement.ondragstart = dragPacket;
        incomingList.appendChild(packetElement);
    });
    
    setupDropZones();
    updateProgress();
}

// Drag and drop functionality
function dragPacket(event) {
    draggedPacket = event.target;
    event.target.classList.add('dragging');
}

function setupDropZones() {
    const suspiciousColumn = document.getElementById('suspiciousList');
    const incomingColumn = document.getElementById('incomingList');
    
    [suspiciousColumn, incomingColumn].forEach(column => {
        column.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        column.addEventListener('drop', (e) => {
            e.preventDefault();
            if (draggedPacket) {
                column.appendChild(draggedPacket);
                draggedPacket.classList.remove('dragging');
                updateProgress();
                
                // Visual feedback for correct moves
                if (column.id === 'suspiciousList' && draggedPacket.dataset.suspicious === 'true') {
                    draggedPacket.classList.add('success-pulse');
                    setTimeout(() => {
                        draggedPacket.classList.remove('success-pulse');
                    }, 500);
                }
            }
        });
    });
}

// Update progress based on correct selections
function updateProgress() {
    const packetsInSuspicious = Array.from(suspiciousList.querySelectorAll('.packet-item'));
    const correctSelections = packetsInSuspicious.filter(packet => 
        packet.dataset.suspicious === 'true'
    ).length;
    
    progress = (correctSelections / packets.filter(p => p.suspicious).length) * 100;
    progressElement.style.width = `${progress}%`;
    progressText.textContent = `Progress: ${Math.round(progress)}%`;
    
    submitBtn.disabled = packetsInSuspicious.length === 0;
}

// Timer
function startTimer() {
    timerInterval = setInterval(() => {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // Change timer color when time is running low
        if (timeLeft <= 30) {
            timerElement.style.color = '#ff5555';
            timerElement.style.animation = 'pulse-warning 1s infinite';
        }
        
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            submitAnalysis();
        }
    }, 1000);
}

// Submit analysis
function submitAnalysis() {
    if (gameCompleted) return;
    clearInterval(timerInterval);
    gameCompleted = true;
    
    attemptsLeft--;
    attemptsElement.textContent = attemptsLeft;
    
    const packetsInSuspicious = Array.from(suspiciousList.querySelectorAll('.packet-item'));
    const correctSelections = packetsInSuspicious.filter(packet => 
        packet.dataset.suspicious === 'true'
    ).length;
    const incorrectSelections = packetsInSuspicious.filter(packet => 
        packet.dataset.suspicious === 'false'
    ).length;
    
    const totalSuspicious = packets.filter(p => p.suspicious).length;
    const accuracy = Math.round((correctSelections / totalSuspicious) * 100);
    
    scoreDisplay.textContent = `Accuracy: ${accuracy}%`;
    
    if (accuracy >= 80) { // Lowered threshold for success
        resultTitle.textContent = "‚úÖ Analysis Complete!";
        resultDetails.innerHTML = `<p style="color:#155724;font-weight:bold;">Good job! You identified most suspicious packets correctly!</p>
                                  <p>Found ${correctSelections}/${totalSuspicious} suspicious packets.</p>`;
        setTimeout(() => {
            window.location.href = 'next-task.html';
        }, 2000);
    } else {
        if (attemptsLeft > 0) {
            resultTitle.textContent = "‚ùå Analysis Incomplete";
            resultDetails.innerHTML = `
                <p style="color:#721c24;">Found ${correctSelections}/${totalSuspicious} suspicious packets.</p>
                <p>${incorrectSelections} false positives detected.</p>
                <p style="color:#721c24;">${attemptsLeft} attempt(s) remaining.</p>
                <p><strong>Hint:</strong> Look for packets with red blinking dots and unusual ports!</p>
                <button onclick="retryAttempt()" style="margin-top:10px; padding:10px 20px; background:green; color:white; border:none; border-radius:5px; cursor:pointer;">Try Again</button>
            `;
        } else {
            resultTitle.textContent = "üö´ Maximum Attempts Reached";
            resultDetails.innerHTML = '<p style="color:#721c24;">Training failed. Please review network security protocols.</p>';
            submitBtn.disabled = true;
        }
    }
    
    resultsElement.style.display = 'block';
}

function retryAttempt() {
    gameCompleted = false;
    progress = 0;
    updateProgress();
    resultsElement.style.display = 'none';
    initializePackets();
    timeLeft = 3 * 60;
    timerElement.textContent = "03:00";
    startTimer();
}

function resetSelection() {
    if (!gameCompleted) {
        initializePackets();
    }
}

// Initialize
createBinaryRain();
initializePackets();
startTimer();

// Event listeners
submitBtn.addEventListener('click', submitAnalysis);
resetBtn.addEventListener('click', resetSelection);
</script>
</body>
</html>